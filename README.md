üõ°Ô∏è **Advanced Malware Detection with PySpark in Network Traffic**

### Project Description
This project tackles malware detection in network traffic data using PySpark for large-scale data processing and MLlib for building machine learning models. The main goal is to classify IPs as malicious or benign using a Random Forest model.

### Technologies Used:
- Python
- PySpark
- MLlib
- Google Cloud Dataproc

### Dataset
**Source:** "A labeled dataset with malicious and benign IoT network traffic" from the Stratosphere Laboratory.  
**Citation:** Stratosphere Laboratory. A labeled dataset with malicious and benign IoT network traffic. January 22nd. Agustin Parmisano, Sebastian Garcia, Maria Jose Erquiaga. Stratosphere IPS.
**Download:** [Download dataset from Kaggle](https://www.kaggle.com/datasets/agungpambudi/network-malware-detection-connection-analysis/data?select=CTU-IoT-Malware-Capture-8-1conn.log.labeled.csv)

### Project Structure
**Notebooks:**
- `1- spark_intro-eda-cleaning.ipynb`: Introduction to PySpark with Exploratory Data Analysis (EDA) and data cleaning.
- `2 - Spark_Feature_Engineering_ML_Pipeline.ipynb`: Advanced feature engineering and implementation of a machine learning pipeline with PySpark, including feature creation and modeling with Random Forest.

**Scripts for production deploy:**
- `config.yaml`: Configuration file for setting general parameters for local usage.
- `gcs_config.yaml`: Configuration file for deploying on Google Cloud Dataproc.
- `feature_engineering.py`: Functions for feature creation.
- `pipe.py`: Code for deploying the pipeline based on the notebooks.
- `cleaning.py`: Functions for data cleaning.
- `ml_prep.py`: Functions for preparing data for machine learning.
- `tuning.py`: Functions for hyperparameter tuning.


### Features
- **Exploratory Data Analysis (EDA) and cleaning:** cleaning, visualization and analysis of network traffic data to identify patterns and important variables
- **Feature Engineering:** Application of advanced techniques such as moving averages to transform and select relevant features. Since we have a time-component to this data, we can engineer all sorts of rolling features.
- **Predictive Modeling:** Training and evaluation of a Random Forest model for detecting malicious IPs using MLlib.
- **Machine Learning Pipeline:** Implementation of a robust pipeline, including UDFs and hyperparameter tuning with Hyperopt.
- **Deployment on Google Cloud Dataproc:** Configuration and execution of PySpark jobs on a managed cloud cluster.

### Installation and Usage
Clone the repository:
```bash
git clone https://github.com/estebancalle/advanced-malware-detection-pyspark.git

# Navigate to the project directory:
cd advanced-malware-detection-pyspark
```

Install the dependencies using Conda:
```bash
conda env create -f conda-env.yaml
conda activate malware-detection-env
```
Configure the parameters:

Edit `config.yaml` to adjust general parameters for local usage.
Edit `gcs_config.yaml` if you wish to deploy on Google Cloud Dataproc.
Modify the pipeline script (`pipe.py`) to specify whether to use `config.yaml` or `gcs_config.yaml`.

### Acknowledgments
This project was inspired by the work of [Anton T. Ruberts](https://www.youtube.com/@atruberts). Special thanks for the detailed tutorial and guidance.
